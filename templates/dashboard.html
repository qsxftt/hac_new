{% extends "base.html" %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - AI –¢—Ä–µ–Ω–µ—Ä{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            üëã –ü—Ä–∏–≤–µ—Ç, {{ current_user.username }}!
        </h1>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        {% set total_analyses = current_user.analyses.count() %}
        {% set completed_analyses = current_user.analyses.filter_by(status='completed').count() %}
        
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <i class="fas fa-video fa-3x mb-3"></i>
                        <h3>{{ total_analyses }}</h3>
                        <p class="mb-0">–í—Å–µ–≥–æ –∞–Ω–∞–ª–∏–∑–æ–≤</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-3">
                <div class="card bg-success text-white">
                    <div class="card-body text-center">
                        <i class="fas fa-check-circle fa-3x mb-3"></i>
                        <h3>{{ completed_analyses }}</h3>
                        <p class="mb-0">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-3">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <i class="fas fa-calendar-alt fa-3x mb-3"></i>
                        <h3>{{ (current_user.created_at | string)[:10] }}</h3>
                        <p class="mb-0">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <i class="fas fa-upload fa-3x text-primary mb-3"></i>
                        <h5>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</h5>
                        <p class="text-muted">–ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑</p>
                        <a href="{{ url_for('index') }}" class="btn btn-primary">
                            <i class="fas fa-plus"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-3">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <i class="fas fa-history fa-3x text-success mb-3"></i>
                        <h5>–ò—Å—Ç–æ—Ä–∏—è</h5>
                        <p class="text-muted">–í—Å–µ –≤–∞—à–∏ –∞–Ω–∞–ª–∏–∑—ã</p>
                        <a href="{{ url_for('history') }}" class="btn btn-success">
                            <i class="fas fa-list"></i> –°–º–æ—Ç—Ä–µ—Ç—å
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-3">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <i class="fas fa-dumbbell fa-3x text-warning mb-3"></i>
                        <h5>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h5>
                        <p class="text-muted">{{ total_exercises if total_exercises else 0 }} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–Ω–æ</p>
                        {% if analyses %}
                            <a href="{{ url_for('trainer', analysis_id=analyses[0].id) }}" class="btn btn-warning">
                                <i class="fas fa-dumbbell"></i> –û—Ç–∫—Ä—ã—Ç—å
                            </a>
                        {% else %}
                            <button class="btn btn-secondary" disabled>
                                –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–Ω–∞–ª–∏–∑—ã -->
        {% if analyses %}
        <h3 class="mb-3">
            <i class="fas fa-clock"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–Ω–∞–ª–∏–∑—ã
        </h3>
        
        <div class="list-group">
            {% for analysis in analyses %}
            <a href="{{ url_for('results', analysis_id=analysis.id) if analysis.status == 'completed' else '#' }}" 
               class="list-group-item list-group-item-action {{ 'disabled' if analysis.status != 'completed' else '' }}">
                <div class="d-flex w-100 justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-1">
                            <i class="fas fa-video text-primary"></i>
                            {{ analysis.video_filename }}
                        </h5>
                        <p class="mb-1">
                            <span class="badge bg-info">
                                {% if analysis.scenario_type == 'academic' %}–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã
                                {% elif analysis.scenario_type == 'project' %}–ó–∞—â–∏—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
                                {% elif analysis.scenario_type == 'hackathon' %}–•–∞–∫–∞—Ç–æ–Ω/–ø–∏—Ç—á
                                {% elif analysis.scenario_type == 'public' %}–ü—É–±–ª–∏—á–Ω–æ–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ
                                {% elif analysis.scenario_type == 'custom' %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
                                {% else %}{{ analysis.scenario_type }}{% endif %}
                            </span>
                            <span class="badge bg-{{ 'success' if analysis.status == 'completed' else 'warning' if analysis.status == 'processing' else 'danger' }}">
                                {{ analysis.status }}
                            </span>
                        </p>
                        
                        {% if analysis.status == 'completed' and analysis.result %}
                            {% set metrics = analysis.result.get_metrics() %}
                            <small class="text-muted">
                                –¢–µ–º–ø: {{ metrics.get('avg_tempo', 0)|round(1) }} —Å–ª–æ–≤/—Å–µ–∫ | 
                                –ü–∞—É–∑—ã: {{ metrics.get('pauses_count', 0) }} | 
                                –§–∏–ª–ª–µ—Ä—ã: {{ metrics.get('filler_words_count', 0) }}
                            </small>
                        {% endif %}
                    </div>
                    <small class="text-muted">{{ analysis.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
                </div>
            </a>
            {% endfor %}
        </div>
        
        <div class="text-center mt-3">
            <a href="{{ url_for('history') }}" class="btn btn-outline-primary">
                –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∞–Ω–∞–ª–∏–∑—ã <i class="fas fa-arrow-right"></i>
            </a>
        </div>
        {% else %}
        <div class="alert alert-secondary text-center py-5 mt-4" role="alert">
            <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
            <h4>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–Ω–∞–ª–∏–∑–æ–≤</h4>
            <p class="text-muted">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ –∏ –Ω–∞—á–Ω–∏—Ç–µ —É–ª—É—á—à–∞—Ç—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏!</p>
            <a href="{{ url_for('index') }}" class="btn btn-primary mt-3">
                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
